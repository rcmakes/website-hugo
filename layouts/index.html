{{ define "main" }}

<!-- Alerts -->
<script>  
//fetch("/.netlify/functions/calendar", {
//    method: "get"
//  })
//  .then(res => res.json())
//  .then(json => console.log(json))
//  .then(json => document.getElementById("nextDate").innerHTML = json);



  var makeQuerystring = params =>
        Object.keys(params)
        .map(key => {
            return encodeURIComponent(key) + "=" + encodeURIComponent(params[key]);
        })
        .join("&");
    
    var url = "https://www.googleapis.com/calendar/v3/calendars/rcmakes.calendar@gmail.com/events";
    var querystring = makeQuerystring({
        q: "Makerspace"
    });
    var today = new Date();

    var yearRn = today.getFullYear();
    var monthRn = today.getMonth()+1;
    var dayRn = today.getDate();
    var hoursRn = today.getHours();
    var minutesRn = today.getMinutes();
    var datetime = new Date(yearRn, monthRn, dayRn, hoursRn, 00,00);
    var indexarray = [];
    fetch(url + "?" + querystring, {
        method: "get",
        headers: {
        Authorization: "Bearer " + {{ getenv "API_KEY" }}
        }
    })
    .then(res => res.json())
    .then(json => values = json.items)
    .then(values => values.some((element, index) => {
        var length = values.length;
        var date = element.end.dateTime.split('-');
        var newdate = new Date(date[0], date[1], date[2].split("T")[0], date[2].split("T")[1].split(":")[0]);
        if(newdate >= datetime){
        var updatedDate =  new Date(date[0], date[1]-1, date[2].split("T")[0], date[2].split("T")[1].split(":")[0]);
        indexarray.push(updatedDate);
        }; 
        var mydate = new Date(newdate[0], newdate[1] , newdate[2]);
        if(index+1 == length){
        var date_sort_asc = function (date1, date2) {
            if (date1 > date2) return 1;
            if (date1 < date2) return -1;
            return 0;
            };
        indexarray.sort(date_sort_asc);
        var stringified = indexarray[0].toString();
        var month = stringified.slice(4,7);
        var day = stringified.slice(8,10);
        var weekday = stringified.slice(0,3);
        if(weekday == "Sat"){
            defWeekDay = "Saturday"
        }
        else if(weekday == "Sun"){
            defWeekDay = "Sunday"
        }
        else if(weekday == "Mon"){
            defWeekDay = "Monday"
        }
        else if(weekday == "Tue"){
            defWeekDay = "Tuesday"
        }
        else if(weekday == "Wed"){
            defWeekDay = "Wednesday"
        }
        else if(weekday == "Thu"){
            defWeekDay = "Thursday"
        }
        else if(weekday == "Fri"){
            defWeekDay = "Friday"
        };
        if(month == "Jan"){
            defMonth = "January"
        }
        else if(month == "Feb"){
            defMonth = "February"
        }
        else if(month == "Mar"){
            defMonth = "March"
        }
        else if(month == "Apr"){
            defMonth = "April"
        }
        else if(month == "May"){
            defMonth = "May"
        }
        else if(month == "Jun"){
            defMonth = "June"
        }
        else if(month == "Jul"){
            defMonth = "July"
        }
        else if(month == "Aug"){
            defMonth = "August"
        }
        else if(month == "Sep"){
            defMonth = "September"
        }
        else if(month == "Oct"){
            defMonth = "October"
        }
        else if(month == "Nov"){
            defMonth = "November"
        }
        else if(month == "Dec"){
            defMonth = "December"
        };
        if(day == "01"){
            defDay = "1st"
        }
        else if(day == "02"){
            defDay = "2nd"
        }
        else if(day == "03"){
            defDay = "3rd"
        }
        else if(parseInt(day) >= 04 && parseInt(day) <= 20){
            defDay = day + "th"
        }
        else if(day == "21"){
            defDay = "21st"
        }
        else if(day == "22"){
            defDay = "22nd"
        }
        else if(day == "23"){
            defDay = "23rd"
        }
        else if(parseInt(day) >= 24){
            defDay = day + "th"
        };
        var doneDate = defWeekDay + " " + defMonth + " " + defDay;
        document.getElementById("nextDate").innerHTML = doneDate;

    }
    }))
</script>
<section class="alert alert-success">
  
  <div class="row">
    
    <div class="col-lg-12">
      <p id="fooHolder"></p>
      <p class="mt-2 text-center h5">
        The Community Makerspace will be open next on June 1st. New hours are 8am-Noon.
      </p>
    </div>

  </div>

</section>

<section class="row">

  <div class="col-lg-12">
    <h3>Try it out</h3>
    <p><a href="https://develop.rcmakes.com/.netlify/functions/calendar">Say hello!</a></p>

    <div class="jumbotron py-3">
      <div class="row">
        <div class="col-lg-12">
          <h1 class="display-responsive pb-3 text-center">
            Student-Powered Entrepreneurship
          </h1>          
        </div>
      </div>

      <div class="row">
        <div class="col-lg-6 my-flex-item pb-3">
          <p class="lead">
            RCMakes is a non-profit conglomerate operated by students at Rancho Campana High School. Services include an online store selling wares made by students, a community makerspace, a build-to-spec job shop for individual and business customers, expanded learning programs for incoming and current high school students, video production, software development and graphic design.
          </p>
          <hr class="my-4">
          <p>
            We produce goods and services, provide internships and student employment, award earned academic
            scholarships, and incubate startup businesses.
          </p>
          <p class="lead">
            <a class="btn btn-primary btn-lg" href="/about" role="button">Learn More</a>
          </p>
        </div>
        <div class="col-lg-6 my-2">
          {{ partial "carousel-homepage" . }}
        </div>
      </div>
    </div>
    <div class="mt-2">
      {{partial "services" .}}
    </div>

  </div>

</section>

<div class="mt-4">
  {{ partial "clients" . }}
</div>


{{ end }}
